# Build application
FROM node:16 as build-stage
WORKDIR /app
RUN mkdir /app/backend /app/shared

COPY package*.json ./
COPY ./backend/package.json ./backend
COPY ./shared/package.json ./shared

RUN npm install

ADD ./backend /app/backend
ADD ./shared /app/shared

WORKDIR /app/backend
RUN npm run build

ENV NODE_ENV=production

CMD ["node", "./dist/index.js"]